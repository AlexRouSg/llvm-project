host_triple = config.target_triple

# Force triple on non-linux hosts to get ELF binaries on all platforms.
if not "linux" in host_triple:
  host_triple = host_triple.split("-")[0] + "-unknown-linux-gnu"

# By default, %cflags/%cxxflags enable position-independent code. To be explicit
# in tests, use %base_cflags/%base_cxxflags and provide any relevant flags, ie
# -fPIE/-fPIC/-pie, and -fno-PIE/-fno-PIC/-no-pie

common_linker_flags = "-fuse-ld=lld -Wl,--unresolved-symbols=ignore-all -Wl,--build-id=none"

flags_base = f"--target={host_triple} {common_linker_flags}"
config.substitutions.insert(0, ("%base_cflags", f"%cflags {flags_base}"))
config.substitutions.insert(0, ("%base_cxxflags", f"%cxxflags {flags_base}"))

flags_pie = f"{flags_base} -fPIE -pie"
config.substitutions.insert(0, ("%cflags", f"%cflags {flags_pie}"))
config.substitutions.insert(0, ("%cxxflags", f"%cxxflags {flags_pie}"))
